% Outils divers à charger
\RequirePackage{etoolbox}
\RequirePackage{xstring}

% Commande pour afficher les siècles
\DeclareRobustCommand{\cRM}[1]{\MakeUppercase{\expandafter\romannumeral #1}}	% Capital
\DeclareRobustCommand{\cRm}[1]{\textsc{\romannumeral #1}}	% Petit majuscule
\DeclareRobustCommand{\crm}[1]{\romannumeral #1}
\DeclareRobustCommand{\siecle}[1]{\cRm{#1}\textsuperscript{e}~siècle}
\DeclareRobustCommand{\siecles}[2]{\cRm{#1}-\cRm{#2}\textsuperscript{e}~siècles}
% Bibleref

\RequirePackage{bibleref-french}
\biblerefstyle{defaultshorter}

% csquotes
\usepackage{csquotes}


% Pour les références bibliques 

\newcommand{\bibleref}[1]{
	%Commande pour afficher un passage biblique, c'est elle qui est appellée par tt les autres
	\def\passage##1|##2|##3|{\bibleverse{##1}(##2)\ifstrempty{##3}{}{ (##3)}}% L'affichage de chaque passage : 1) livre 2) passage 3) version
	% On commence par faire une liste des passages
	\def\passages{}% Liste des passages
	\numdef\nbpassages{0}% Nbr total de passages
	\DeclareListParser*{\trouvepassages}{+}% Le + est un séparateur
	\trouvepassages{\numdef\nbpassages{\nbpassages+1}\listadd\passages}{#1}% On remplit la liste des passage
	%
	% On la parcourt ensuite
	\numdef\cptpassage{0}% Le nombre de passage courant
	\renewcommand{\do}[1]{% Ce qu'on effectue à chaque boucle
		\numdef\cptpassage{\cptpassage+1}% Incrémenter le compteur du passage courant
		\IfSubStr[2]{##1}{|}% Tester si on a 2 ou 3 élèments dans le passage
			{\passage##1|} % Si 3 élèments, donc 2 |
			{\passage##1||}% Si 2 élèments, donc 1 |
		\ifnumequal{\nbpassages}{\cptpassage}{.}{ ; }% y a t'il encore des passages ensuite?
	}%
	\dolistloop{\passages}% Boucler sur tt les passages
	%
}

\newcommand*{\biblefr}[1]{\emph{#1}} % pour un fragment de bible seulement
\newcommand*{\bible}[2]{%
	%#1 : passage
	%#2 : texte
	\emph{#2}\footnote{\bibleref{#1}}%
}
\newcommand*{\bibleall}[1]{%
	%#1 : passage
	\footnote{\emph{Cf}. \bibleref{#1}}%
	}